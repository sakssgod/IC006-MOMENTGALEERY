<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Album</title>
    <link rel="stylesheet" href="../style/InsideAlbum.css">
    <link rel="stylesheet" href="../IconFiles/icon素材/iconfont.css">
</head>
<body>     
    <div class="topnav">
        <a href="AlbumPage.html">Back</a>
        <span class="title"></span>
        <a class="deleteBtn">Delete</a>
    </div>
    
   <div class="album-container">
        <div class="album-item add-Photo">
            <div class="icon plus">&#xe605;</div>
            <div class="Photo-name">Add New Photo</div>
        </div>
        <div class="album-item" data-photo-id="1">
            <a href="PhotoInfoPage.html">
                <input type="checkbox" class="deleteCheckbox">
                <div class="icon album">&#xe618;</div>
                <div class="Photo-name">Photo1</div>
            </a>
        </div>
        <div class="album-item" data-photo-id="2">
            <a href="PhotoInfoPage.html">
                <input type="checkbox" class="deleteCheckbox">
                <div class="icon album">&#xe618;</div>
                <div class="Photo-name">Photo2</div>
            </a>
        </div>
        <div class="album-item" data-photo-id="3">
            <a href="PhotoInfoPage.html">
                <input type="checkbox" class="deleteCheckbox">
                <div class="icon album">&#xe618;</div>
                <div class="Photo-name">Photo3</div>
            </a>
        </div>
        <div class="album-item" data-photo-id="4">
            <a href="PhotoInfoPage.html">
                <input type="checkbox" class="deleteCheckbox">
                <div class="icon album">&#xe618;</div>
                <div class="Photo-name">Photo4</div>
            </a>
        </div>
        <div class="album-item" data-photo-id="5">
            <a href="PhotoInfoPage.html">
                <input type="checkbox" class="deleteCheckbox">
                <div class="icon album">&#xe618;</div>
                <div class="Photo-name">Photo5</div>
            </a>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const albumName = params.get('albumName');
            document.querySelector('.title').textContent = albumName || 'Unnamed Album';
        });

        const checkboxes = document.querySelectorAll('.deleteCheckbox');
        const deleteBtn = document.querySelector('.deleteBtn');
        
        deleteBtn.style.visibility = 'hidden'; 
        deleteBtn.style.pointerEvents = 'none'; 
        
        const bindCheckboxEvent = (checkbox) => {
            checkbox.addEventListener('change', () => {
                const anyChecked = Array.from(document.querySelectorAll('.deleteCheckbox')).some(cb => cb.checked);
                deleteBtn.style.visibility = anyChecked ? 'visible' : 'hidden';
                deleteBtn.style.pointerEvents = anyChecked ? 'auto' : 'none';
            });
        };

    
        deleteBtn.addEventListener('click', () => {
            const selectedPhotos = document.querySelectorAll('.deleteCheckbox:checked');

            if (selectedPhotos.length > 0) {
                const photoNames = Array.from(selectedPhotos).map(checkbox => {
                    return checkbox.closest('.album-item').querySelector('.Photo-name').textContent;
                });

                const message = selectedPhotos.length === 1
                    ? `Are you sure you want to delete "${photoNames[0]}"?`
                    : `Are you sure you want to delete these photos: ${photoNames.join(', ')}?`;

                const confirmDelete = confirm(message);

                if (confirmDelete) {
                    selectedPhotos.forEach(checkbox => checkbox.closest('.album-item').remove());
                    updateDeleteBtnState();
                }
            }
        });

        const albumContainer = document.querySelector('.album-container');
        let albumCounter = albumContainer.querySelectorAll('.album-item').length - 1;
        const addPhotoButton = document.querySelector('.add-Photo');

        document.querySelector('.album-container').addEventListener('click', (event) => {
            if (event.target.closest('.album-item.add-Photo')) {
                albumCounter++; 
                const newPhoto = document.createElement('div');
                newPhoto.classList.add('album-item');
                newPhoto.innerHTML = `
                <input type="checkbox" class="deleteCheckbox">
                <div class="icon album">&#xe618;</div>
                <div class="Photo-name">foto${albumCounter}</div>
            `;
                albumContainer.appendChild(newPhoto);
                const newCheckbox = newAlbum.querySelector('.deleteCheckbox');
                bindCheckboxEvent(newCheckbox);
                bindPhotoClickEvent(newPhoto); 
            }
            newPhoto.addEventListener('click', (event) => {
                if (event.target.classList.contains('deleteCheckbox')) return;

                const albumName = document.querySelector('.topnav .title').textContent.trim();
                const photoName = newPhoto.querySelector('.Photo-name').textContent;
                window.location.href = `PhotoInfoPage.html?albumName=${encodeURIComponent(albumName)}&photoName=${encodeURIComponent(photoName)}`;
            });
        });

        const bindPhotoClickEvent = (photo) => {
            photo.addEventListener('click', (event) => {
                if (event.target.classList.contains('deleteCheckbox')) return;

                const albumName = document.querySelector('.topnav .title').textContent.trim();
                const photoName = newPhoto.querySelector('.Photo-name').textContent;
                window.location.href = `PhotoInfoPage.html?albumName=${encodeURIComponent(albumName)}&photoName=${encodeURIComponent(photoName)}`;
            });
        };

        document.querySelectorAll('.deleteCheckbox').forEach(bindCheckboxEvent);

        document.querySelectorAll('.album-item:not(.add-photo)').forEach(bindPhotoClickEvent);
    </script>
</body>
</html>
